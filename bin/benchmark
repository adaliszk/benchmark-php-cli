#!/usr/bin/env bash

/usr/bin/php -r 'file_put_contents("/out/".getenv("CONTAINER_NAME")."-modules", strtoupper(implode(",", get_loaded_extensions())));'
modules=$(cat "/out/$CONTAINER_NAME-modules")
printf "Configuration: $modules\n"

scripts=/srv/*.php
for file in $scripts
do
	filename="${file##*/}"
	basename="${filename%.*}"

	printf "\nBenchmarking $basename...\n"
	rm "/out/$CONTAINER_NAME-$basename"
	/opt/mesure $basename
	
	printf "\nGenerating result for $basename...\n"
	/opt/result $basename
done
